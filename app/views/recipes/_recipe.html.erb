<% images = ['no-photo_xymghw.webp', 'no-photo_a_rcwsdh.webp', 'jsrnrkphctyr3juntbku2yjmvdcr.webp', 'v1745928510/idee-tort-2_ei3yzy.webp', 'idee-tort-3_q4vczw.webp', 'idee-tort-1_vbl6kb.webp', 'idee-tort_sklqis.jpg'] %>
  
<div class="card-container-recipes" id="<%= recipe.slug %>" style="background-color: <%= card_container_recipes_background_color %>;">
  <% if controller_path == 'recipes' && action_name == 'index' && params[:category_id].present? && recipe.supports_online_ordering? %>
    <div class="online-order-recipe" title="Disponibil pentru comandă online">
      <i class="fa-solid fa-basket-shopping"></i>
    </div>
  <% end %>
  <%= link_to recipe_path(recipe) do %>
    <div class="card-link-container-recipes">
      <div class="card-image-recipes">
        <% if controller_path == 'dashboard/recipes' %>
          <div class="favored-recipe">
            <% if recipe.favored %>
              <i class="fa-solid fa-heart"></i>
            <% else %>
              <i class="fa-regular fa-heart"></i>
            <% end %>
          </div>
        <% end %>
        <% if recipe.photo.present? %>
          <%= cl_image_tag(recipe.photo.key, alt: recipe.name, fetch_format: :webp, width: 500, crop: :scale) %>
        <% else %>
          <%= cl_image_tag(images.sample, alt: recipe.name, class: 'card-image__no-image', fetch_format: :webp, width: 500, crop: :scale) %>
          <p class="card-image__no-image-text">Fără imagine</p>
        <% end %> <!--if end-->
      </div>
      <div class='card-title-recipes'>
        <div class="card-title-text">
          <h2><%= recipe.name %>
          <% if recipe.energetic_value && controller_path == 'dashboard/recipes' %><i class="fa-brands fa-nutritionix"></i><% end %>
          <% if recipe.vegan %><i class="fa-solid fa-carrot"></i><% end %>
          </h2>
        </div>
        <div class="card-description">
          <span><%= card_recipe_description(recipe.content) %>... <i class="fa-solid fa-circle-info"></i></span>
        </div>
        <!-- <div class='card-rating d-flex justify-content-center align-items-center'>
            <%= "Scor #{recipe.overall_rating.to_f.round(2)} din" if recipe.no_of_ratings.to_i > 0 %>
            <%= recipe.no_of_ratings %>
            <%= '☆' * recipe.overall_rating.to_i %>
        </div> -->
      </div>
    </div>  
    <% end %>
    <div class="card-price-sec">
      <% if recipe.price != 0 %>
      <div class="price-design">
        <span><% humanized_money_with_symbol(recipe.price).split(Regexp.union([',', ' '])).each do |el| %>
            <span><%= el.downcase %></span>
          <% end %>
        </span>
        <hr>
        <% unit_value = recipe.kg_buc.presence || recipe.sold_by.presence || 'kg' %>
        <span class="price-design-kg"><%= unit_value %></span>
      </div>
      <% elsif recipe.price == 0 %>
      <div class="price-design">
        <span>-,-- lei</span>
        <hr>
        <% unit_value = recipe.sold_by.presence || recipe.kg_buc.presence || 'kg' %>
        <span class="price-design-kg"><%= unit_value %></span>
      </div>
      <% end %>
    </div>
    <% if recipe.supports_online_ordering? %>
      <% default_quantity = 1 %>
      <div class="card-add-to-cart">
        <%= form_with url: shop_cart_items_path, method: :post, data: { turbo: false }, class: 'card-add-to-cart__form d-inline-block' do |f| %>
          <%= hidden_field_tag :recipe_id, recipe.id %>
          <%= hidden_field_tag 'cart_item[quantity]', default_quantity %>
          <button type="submit" class="btn btn-sm btn-outline-primary" title="Adaugă în coș">
            <i class="fa-solid fa-cart-plus"></i>
          </button>
        <% end %>
      </div>
    <% end %>
    <% if policy(recipe).edit? && policy(recipe).destroy? && controller_path == 'dashboard/recipes'%>
      <div class='card-crud'>
        <%= link_to "#", data: { bs_toggle: "modal", bs_target: "#edit#{recipe.slug}"} do %><i class="far fa-edit"></i><% end %>
        <%= render partial: 'recipes/modal', locals: { new: false,  modal_id: "edit#{recipe.slug}", recipe: recipe, category: recipe.category } %>
        <%= link_to category_recipe_path(recipe.category, recipe), method: :delete, data: {confirm: 'Vrei să ștergi acest produs?'} do %><i class="fas fa-trash-alt"></i><% end %>
      </div>
    <% end %>
  </div>
