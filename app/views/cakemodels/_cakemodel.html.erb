<% images = ['no-photo_xymghw.webp', 'no-photo_a_rcwsdh.webp', 'jsrnrkphctyr3juntbku2yjmvdcr.webp', 'v1745928510/idee-tort-2_ei3yzy.webp', 'idee-tort-3_q4vczw.webp', 'idee-tort-1_vbl6kb.webp', 'idee-tort_sklqis.jpg'] %>
<% display_price = cakemodel.final_price.presence || cakemodel.price_per_piece.presence %>
<% formatted_price = display_price.present? ? number_with_precision(display_price, precision: 2, separator: ',', delimiter: '.') : '-,--' %>
<% description_source = if cakemodel.content.respond_to?(:to_plain_text)
                          cakemodel.content.to_plain_text
                        else
                          cakemodel.content.to_s
                        end %>
<% model_description = if description_source.present?
                         truncate(description_source, length: 90)
                       else
                         'Model personalizabil în funcție de design și rețetă.'
                       end %>

<div class="card-container-recipes">
  <% if cakemodel.available_online? %>
    <div class="online-order-recipe" title="Disponibil pentru comandă online">
      <i class="fa-solid fa-basket-shopping"></i>
    </div>
  <% end %>

  <%= link_to cakemodel_path(cakemodel) do %>
    <div class="card-link-container-recipes">
      <div class="card-image-recipes">
        <% if cakemodel.photo.present? %>
          <%= cl_image_tag(cakemodel.photo.key, alt: cakemodel.name, fetch_format: :webp, width: 500, crop: :scale) %>
        <% else %>
          <%= cl_image_tag(images.sample, alt: cakemodel.name, class: 'card-image__no-image', fetch_format: :webp, width: 500, crop: :scale) %>
          <p class="card-image__no-image-text">Fără imagine</p>
        <% end %>
      </div>

      <div class="card-title-recipes">
        <div class="card-title-text">
          <h2><%= cakemodel.name %></h2>
        </div>
        <div class="card-description">
          <span><%= model_description %>... <i class="fa-solid fa-circle-info"></i></span>
        </div>
      </div>
    </div>
  <% end %>

  <div class="card-price-sec card-price-sec--cakemodel">
    <div class="price-design price-design--cakemodel">
      <span class="price-design-amount">
        <%= formatted_price %>
        <span class="price-design-currency">lei</span>
      </span>
      <hr>
      <span class="price-design-kg">buc.</span>
    </div>
  </div>

  <% if cakemodel.available_online? && display_price.present? && display_price.to_d.positive? %>
    <div class="card-add-to-cart">
      <%= form_with url: shop_cart_items_path, method: :post, data: { turbo: false }, class: 'card-add-to-cart__form d-inline-block' do |f| %>
        <%= hidden_field_tag :cakemodel_id, cakemodel.id %>
        <%= hidden_field_tag 'cart_item[quantity]', 1 %>
        <button type="submit" class="btn btn-sm btn-outline-primary" title="Adaugă în coș">
          <i class="fa-solid fa-cart-plus"></i>
        </button>
      <% end %>
    </div>
  <% end %>

  <div class="card-crud">
    <% if policy(cakemodel).edit? %>
      <%= link_to edit_category_cakemodel_path(cakemodel.category, cakemodel) do %>
        <i class="far fa-edit color-fonts"></i>
      <% end %>
    <% end %>
    <% if policy(cakemodel).destroy? %>
      <%= link_to category_cakemodel_path(cakemodel.category, cakemodel), data: { turbo_method: :delete, turbo_confirm: "Ești sigur că vrei să ștergi acest model?" } do %>
        <i class="fas fa-trash-alt color-fonts"></i>
      <% end %>
    <% end %>
  </div>
</div>
